#!/usr/bin/env bash
set -euo pipefail

# Pick a line from atuin history via fzf
line="$(atuin history list | fzf --ansi || true)"
[ -z "${line:-}" ] && exit 0

# 1) Prefer tab-delimited field 2 (atuin's default)
cmd="$(printf '%s' "$line" | awk -F'\t' 'NF>=2 {print $2}')"

# 2) Fallback: strip leading timestamp and trailing duration if no tabs
if [ -z "$cmd" ] || [ "$cmd" = "$line" ]; then
  cmd="$(printf '%s' "$line" \
    | sed -E \
      -e 's/^[0-9]{4}-[0-9]{2}-[0-9]{2}[[:space:]]+[0-9]{2}:[0-9]{2}:[0-9]{2}[[:space:]]+//' \
      -e 's/[[:space:]]+[0-9]+(\.[0-9]+)?(ns|us|ms|s|m|h)$//')"
fi

echo "â†’ $cmd"
eval "$cmd"

